<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-me.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-me.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="介绍官方文档：Paging谷歌实验室：官方教程官方Demo：网络方式，数据库方式谷歌官方的介绍：             The Paging Library helps you load and display small chunks of data at a time. Loading partial data on demand reduces usage of network bandw">
<meta name="keywords" content="Android,Jetpack,Paging">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-Jetpack组件：Paging">
<meta property="og:url" content="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/index.html">
<meta property="og:site_name" content="彭真进的博客">
<meta property="og:description" content="介绍官方文档：Paging谷歌实验室：官方教程官方Demo：网络方式，数据库方式谷歌官方的介绍：             The Paging Library helps you load and display small chunks of data at a time. Loading partial data on demand reduces usage of network bandw">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/paging-chapter-1/img1.png">
<meta property="og:image" content="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/paging-chapter-1/img2.png">
<meta property="og:updated_time" content="2019-10-14T10:52:13.363Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android-Jetpack组件：Paging">
<meta name="twitter:description" content="介绍官方文档：Paging谷歌实验室：官方教程官方Demo：网络方式，数据库方式谷歌官方的介绍：             The Paging Library helps you load and display small chunks of data at a time. Loading partial data on demand reduces usage of network bandw">
<meta name="twitter:image" content="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/paging-chapter-1/img1.png">
  <link rel="canonical" href="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Android-Jetpack组件：Paging | 彭真进的博客</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ede0ba70e7eb2eb800e94196368893eb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">彭真进的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">业精于勤荒于嬉，行成于思毁于随</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭真进">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="彭真进的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Android-Jetpack组件：Paging

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-05-24 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-24T00:00:00+08:00">2019-05-24</time>
            </span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>7.6k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>7 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>官方文档：<a href="https://developer.android.com/topic/libraries/architecture/paging" target="_blank" rel="noopener">Paging</a><br>谷歌实验室：官方教程<br>官方Demo：<a href="https://github.com/android/architecture-components-samples/tree/master/PagingWithNetworkSample" target="_blank" rel="noopener">网络方式</a>，<a href="https://github.com/android/architecture-components-samples/tree/master/PagingSample" target="_blank" rel="noopener">数据库方式</a></p><p>谷歌官方的介绍：</p><div class="note default">
            <p>The Paging Library helps you load and display small chunks of data at a time. Loading partial data on demand reduces usage of network bandwidth and system resources.</p>
          </div><a id="more"></a>



<p>可以看到，官方的介绍就是我们上面提及的内容，我们再来看看 Paging 是如何运作的：</p>
<p><img src="paging-chapter-1/img1.png" alt></p>
<p>当然，我需要做更具体的介绍，至于 ViewModel 和 LiveData，可以翻阅我的前几期博客，关键元素如下：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>PagedList</td>
<td>一个可以以分页形式异步加载数据的容器，可以跟 RecyclerView 很好的结合</td>
</tr>
<tr>
<td>DataSource或DataSource.Factory</td>
<td>数据源，DataSource 将数据转变成 PagedList，DataSource.Factory 则用来创建 DataSource</td>
</tr>
<tr>
<td>LivePagedListBuilder</td>
<td>用来生成 LiveData<pagedlist>，需要 DataSource.Factory 参数</pagedlist></td>
</tr>
<tr>
<td>BoundaryCallback</td>
<td>数据到达边界的回调</td>
</tr>
<tr>
<td>PagedListAdapter</td>
<td>一种 RecyclerView 的适配器</td>
</tr>
</tbody></table>
<p><strong>优点</strong></p>
<ul>
<li>RxJava 2 以及 Android Jetpack 的支持，如 LiveData、Room。</li>
<li>自定义分页策略。</li>
<li>异步处理数据。</li>
<li>结合 RecyclerView 等。</li>
</ul>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>因为本文是 Android Jetpack 系列文章，所以主要介绍配合 LiveData 使用，对于 RxJava 的配合使用，本文会一笔带过。</p>
<h4 id="第一步-添加依赖"><a href="#第一步-添加依赖" class="headerlink" title="第一步 添加依赖"></a>第一步 添加依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ext.pagingVersion = &apos;2.1.0-alpha01&apos;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    // ... 省略</span><br><span class="line">    // paging</span><br><span class="line">    implementation &quot;androidx.paging:paging-runtime:$pagingVersion&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第二步-创建数据源"><a href="#第二步-创建数据源" class="headerlink" title="第二步 创建数据源"></a>第二步 创建数据源</h4><p><strong>1. 非 Room 数据库</strong><br>如果没有使用 Room 数据库，我们需要自定义实现 DataSource，通常实现 DataSource 有三种方式，分别继承三种抽象类，它们分别是：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>PageKeyedDataSource&lt;Key, Value&gt;</td>
<td>分页请求数据的场景</td>
</tr>
<tr>
<td>ItemKeyedDataSource&lt;Key, Value&gt;</td>
<td>以表的某个列为 key，加载其后的N个数据（个人理解以某个字段进行排序，然后分段加载数据）</td>
</tr>
<tr>
<td>PositionalDataSource<t></t></td>
<td>当数据源总数特定，根据指定位置请求数据的场景</td>
</tr>
</tbody></table>
<p>这里我们以 PageKeyedDataSource&lt;Key, Value&gt; 为例，虽然这里的数据库使用的是 Room，但我们查询数据以返回 List<shoe> 代表着通常数据库的使用方式：</shoe></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">// 因为代表着不同方式，所以不需要看Dao层</span><br><span class="line">class ShoeRepository private constructor(private val shoeDao: ShoeDao) &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过id的范围寻找鞋子</span><br><span class="line">     */</span><br><span class="line">    fun getPageShoes(startIndex:Long,endIndex:Long):List&lt;Shoe&gt; = shoeDao.findShoesByIndexRange(startIndex,endIndex)</span><br><span class="line"></span><br><span class="line">   //... 省略</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 自定义PageKeyedDataSource</span><br><span class="line"> * 演示Page库的时候使用</span><br><span class="line"> */</span><br><span class="line">class CustomPageDataSource(private val shoeRepository: ShoeRepository) : PageKeyedDataSource&lt;Int, Shoe&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    private val TAG: String by lazy &#123;</span><br><span class="line">        this::class.java.simpleName</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 第一次加载的时候调用</span><br><span class="line">    override fun loadInitial(params: LoadInitialParams&lt;Int&gt;, callback: LoadInitialCallback&lt;Int, Shoe&gt;) &#123;</span><br><span class="line">        val startIndex = 0L</span><br><span class="line">        val endIndex: Long = 0L + params.requestedLoadSize</span><br><span class="line">        val shoes = shoeRepository.getPageShoes(startIndex, endIndex)</span><br><span class="line"></span><br><span class="line">        callback.onResult(shoes, null, 2)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 每次分页加载的时候调用</span><br><span class="line">    override fun loadAfter(params: LoadParams&lt;Int&gt;, callback: LoadCallback&lt;Int, Shoe&gt;) &#123;</span><br><span class="line">        Log.e(TAG, &quot;startPage:$&#123;params.key&#125;,size:$&#123;params.requestedLoadSize&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        val startPage = params.key</span><br><span class="line">        val startIndex = ((startPage - 1) * BaseConstant.SINGLE_PAGE_SIZE).toLong() + 1</span><br><span class="line">        val endIndex = startIndex + params.requestedLoadSize - 1</span><br><span class="line">        val shoes = shoeRepository.getPageShoes(startIndex, endIndex)</span><br><span class="line"></span><br><span class="line">        callback.onResult(shoes, params.key + 1)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun loadBefore(params: LoadParams&lt;Int&gt;, callback: LoadCallback&lt;Int, Shoe&gt;) &#123;</span><br><span class="line">       // ... 省略 类似loadAfter</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DataSource 创建好了，再创建一个 DataSource.Factory，这个比较简单，返回上面创建的 CustomPageDataSource 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 构建CustomPageDataSource的工厂</span><br><span class="line"> */</span><br><span class="line">class CustomPageDataSourceFactory(val shoeRepository: ShoeRepository):DataSource.Factory&lt;Int,Shoe&gt;() &#123;</span><br><span class="line">    override fun create(): DataSource&lt;Int, Shoe&gt; &#123;</span><br><span class="line">        return CustomPageDataSource(shoeRepository)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. Room 数据库</strong><br>如果是使用 Room 与 Paging 结合的方式呢？直接在 Room 的 Dao 层中这样使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 鞋子的方法</span><br><span class="line"> */</span><br><span class="line">@Dao</span><br><span class="line">interface ShoeDao &#123;</span><br><span class="line">   //... 省略</span><br><span class="line"></span><br><span class="line">    // 配合LiveData 返回所有的鞋子</span><br><span class="line">    @Query(&quot;SELECT * FROM shoe&quot;)</span><br><span class="line">    fun getAllShoesLD(): DataSource.Factory&lt;Int, Shoe&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不止简单了一个档次。</p>
<h4 id="第三步-构建-LiveData"><a href="#第三步-构建-LiveData" class="headerlink" title="第三步 构建 LiveData"></a>第三步 构建 LiveData<pagedlist></pagedlist></h4><p>想要获得 LiveData<pagedlist> 则需要先创建 LivePagedListBuilder，LivePagedListBuilder 有设分页数量和配置参数两种构造方法，设置分页数量比较简单，直接查看 Api 就可以使用，我们看看如何配置参数使用：</pagedlist></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class ShoeModel constructor(shoeRepository: ShoeRepository) : ViewModel() &#123;</span><br><span class="line">    // 鞋子集合的观察类</span><br><span class="line">    val shoes: LiveData&lt;PagedList&lt;Shoe&gt;&gt; = LivePagedListBuilder&lt;Int, Shoe&gt;(</span><br><span class="line">        CustomPageDataSourceFactory(shoeRepository) // DataSourceFactory</span><br><span class="line">        , PagedList.Config.Builder()</span><br><span class="line">            .setPageSize(10) // 分页加载的数量</span><br><span class="line">            .setEnablePlaceholders(false) // 当item为null是否使用PlaceHolder展示</span><br><span class="line">            .setInitialLoadSizeHint(10) // 预加载的数量</span><br><span class="line">            .build())</span><br><span class="line">        .build()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第四步-创建-PagedListAdapter"><a href="#第四步-创建-PagedListAdapter" class="headerlink" title="第四步 创建 PagedListAdapter"></a>第四步 创建 PagedListAdapter</h4><p>PagedListAdapter 就是特殊的 RecyclerView 的 RecyclerAdapter，跟 RecyclerAdapter 一样，需要继承并实现其方法，这里使用了 Data Binding：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 鞋子的适配器 配合Data Binding使用</span><br><span class="line"> */</span><br><span class="line">class ShoeAdapter constructor(val context: Context) :</span><br><span class="line">    PagedListAdapter&lt;Shoe, ShoeAdapter.ViewHolder&gt;(ShoeDiffCallback()) &#123;</span><br><span class="line"></span><br><span class="line">    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder &#123;</span><br><span class="line">        return ViewHolder(</span><br><span class="line">            RecyclerItemShoeBinding.inflate(</span><br><span class="line">                LayoutInflater.from(parent.context)</span><br><span class="line">                , parent</span><br><span class="line">                , false</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onBindViewHolder(holder: ViewHolder, position: Int) &#123;</span><br><span class="line">        val shoe = getItem(position)</span><br><span class="line">        holder.apply &#123;</span><br><span class="line">            bind(onCreateListener(shoe!!.id), shoe)</span><br><span class="line">            itemView.tag = shoe</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Holder的点击事件</span><br><span class="line">     */</span><br><span class="line">    private fun onCreateListener(id: Long): View.OnClickListener &#123;</span><br><span class="line">        return View.OnClickListener &#123;</span><br><span class="line">            val intent = Intent(context, DetailActivity::class.java)</span><br><span class="line">            intent.putExtra(BaseConstant.DETAIL_SHOE_ID, id)</span><br><span class="line">            context.startActivity(intent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    class ViewHolder(private val binding: RecyclerItemShoeBinding) : RecyclerView.ViewHolder(binding.root) &#123;</span><br><span class="line"></span><br><span class="line">        fun bind(listener: View.OnClickListener, item: Shoe) &#123;</span><br><span class="line">            binding.apply &#123;</span><br><span class="line">                this.listener = listener</span><br><span class="line">                this.shoe = item</span><br><span class="line">                executePendingBindings()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>布局文件只有一个ImageView，不再赘述。</p>
<h4 id="第五步-监听数据"><a href="#第五步-监听数据" class="headerlink" title="第五步 监听数据"></a>第五步 监听数据</h4><p>同样使用了 Data Binding，FragmentShoe 的布局仅仅只用了一个 RecyclerView，比较简单，也不再赘述。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 鞋子页面</span><br><span class="line"> */</span><br><span class="line">class ShoeFragment : Fragment() &#123;</span><br><span class="line"></span><br><span class="line">    // ... 省略</span><br><span class="line"></span><br><span class="line">    override fun onCreateView(</span><br><span class="line">        inflater: LayoutInflater, container: ViewGroup?,</span><br><span class="line">        savedInstanceState: Bundle?</span><br><span class="line">    ): View? &#123;</span><br><span class="line">        val binding: FragmentShoeBinding = FragmentShoeBinding.inflate(inflater, container, false)</span><br><span class="line">        context ?: return binding.root</span><br><span class="line">        val adapter = ShoeAdapter(context!!)</span><br><span class="line">        binding.recycler.adapter = adapter</span><br><span class="line">        onSubscribeUi(adapter)</span><br><span class="line">        return binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 鞋子数据更新的通知</span><br><span class="line">     */</span><br><span class="line">    private fun onSubscribeUi(adapter: ShoeAdapter) &#123;</span><br><span class="line">        viewModel.shoes.observe(viewLifecycleOwner, Observer &#123;</span><br><span class="line">            if (it != null) &#123;</span><br><span class="line">                adapter.submitList(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们的程序就可以分段加载数据了，感兴趣的可以打一下日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2019-06-30 17:15:00.564 32051-32117/com.joe.jetpackdemo E/CustomPageDataSource: startPage:2,size:10</span><br><span class="line">2019-06-30 17:15:02.836 32051-32112/com.joe.jetpackdemo E/CustomPageDataSource: startPage:3,size:10</span><br><span class="line">2019-06-30 17:15:13.705 32051-32113/com.joe.jetpackdemo E/CustomPageDataSource: startPage:4,size:10</span><br><span class="line">2019-06-30 17:15:15.869 32051-32116/com.joe.jetpackdemo E/CustomPageDataSource: startPage:5,size:10</span><br><span class="line">2019-06-30 17:15:19.986 32051-32117/com.joe.jetpackdemo E/CustomPageDataSource: startPage:6,size:10</span><br><span class="line">2019-06-30 17:15:22.102 32051-32112/com.joe.jetpackdemo E/CustomPageDataSource: startPage:7,size:10</span><br></pre></td></tr></table></figure>

<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p>RxJava 2 如此强大，怎么能少了对 RxJava 2 的支持呢？对于上述的代码，我们只要将数据观测的 LiveData 修改成 RxJava 2 就行了，因为 Room 对 RxJava 2 也提供了支持，并且 RxJava 2 和 LiveData 做的本质工作是相同的，这里不写代码了，感兴趣的稍微查看一下官方文档就行了。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="paging-chapter-1/img2.png" alt></p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="https://www.loongwind.com/archives/367.html" target="_blank" rel="noopener">《Android Jetpack之Paging初探》</a><br><a href="https://developer.android.com/topic/libraries/architecture/paging" target="_blank" rel="noopener">《官方文档》</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="\2019\05\21\Android-Jetpack组件：DataBinding\" rel="bookmark">Android-Jetpack组件：DataBinding</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="\2019\05\20\Android-Jetpack组件：Navigation\" rel="bookmark">Android-Jetpack组件：Navigation</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="\2019\05\22\Android-Jetpack组件：ViewModel和LiveData\" rel="bookmark">Android-Jetpack组件：ViewModel和LiveData</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="\2019\05\25\Android-Jetpack组件：WorkManager\" rel="bookmark">Android-Jetpack组件：WorkManager</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="\2019\05\23\Android-Jetpack组件：Room\" rel="bookmark">Android-Jetpack组件：Room</a></div>
      
    </li>
  
  </ul>

        
      
        <div id="reward-container">
  <div></div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/uploads/wechatpay.png" alt="彭真进 微信支付">
        <p>微信支付</p>
      </div>
        
      
      <div style="display: inline-block">
        <img src="/uploads/alipay.png" alt="彭真进 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>彭真进</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/" title="Android-Jetpack组件：Paging">http://pengzhenjin.top/2019/05/24/Android-Jetpack组件：Paging/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
            
              <a href="/tags/Jetpack/" rel="tag"><i class="fa fa-tag"></i> Jetpack</a>
            
              <a href="/tags/Paging/" rel="tag"><i class="fa fa-tag"></i> Paging</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/05/23/Android-Jetpack组件：Room/" rel="next" title="Android-Jetpack组件：Room">
                  <i class="fa fa-chevron-left"></i> Android-Jetpack组件：Room
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/05/25/Android-Jetpack组件：WorkManager/" rel="prev" title="Android-Jetpack组件：WorkManager">
                  Android-Jetpack组件：WorkManager <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#介绍"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实战"><span class="nav-number">2.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一步-添加依赖"><span class="nav-number">2.1.</span> <span class="nav-text">第一步 添加依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二步-创建数据源"><span class="nav-number">2.2.</span> <span class="nav-text">第二步 创建数据源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三步-构建-LiveData"><span class="nav-number">2.3.</span> <span class="nav-text">第三步 构建 LiveData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第四步-创建-PagedListAdapter"><span class="nav-number">2.4.</span> <span class="nav-text">第四步 创建 PagedListAdapter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第五步-监听数据"><span class="nav-number">2.5.</span> <span class="nav-text">第五步 监听数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更多"><span class="nav-number">3.</span> <span class="nav-text">更多</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考文章"><span class="nav-number">5.</span> <span class="nav-text">参考文章</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="彭真进">
  <p class="site-author-name" itemprop="name">彭真进</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/pengzhenjin" title="GitHub &rarr; https://github.com/pengzhenjin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:562260994@qq.com" title="E-Mail &rarr; mailto:562260994@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://hexo.io/zh-cn" title="https://hexo.io/zh-cn" rel="noopener" target="_blank">Hexo</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://theme-next.org/docs" title="https://theme-next.org/docs" rel="noopener" target="_blank">NexT</a>
        </li>
      
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">彭真进 版权所有</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">454k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">6:53</span>
</div>

        












        
      </div>
    </footer>
  </div>

  


    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'a0aefd8233242f4272c5',
      clientSecret: '89cbd8c8415d03a931cdeba5a9146e38803a1ad7',
      repo: 'pengzhenjin.github.io',
      owner: 'pengzhenjin',
      admin: ['pengzhenjin'],
      id: '6987a5ea7338d8df7c61e58e73e98884',
        language: 'zh-CN',
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
